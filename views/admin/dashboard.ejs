<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>

<div class="admin-layout">
  <aside class="admin-sidebar">
    <div class="sidebar-header">
      <h2 class="sidebar-logo">ğŸ“Š Admin Panel</h2>
    </div>

    <nav class="sidebar-nav">
      <ul class="nav-menu">
        <li class="nav-item active">
          <a href="/admin/dashboard" class="nav-link">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-text">Dashboard</span>
          </a>
        </li>
      </ul>
    </nav>

    <div class="sidebar-footer">
      <div class="admin-profile">
        <div class="profile-avatar">ğŸ‘¤</div>
        <div class="profile-info">
          <p class="profile-name"><%= admin.name %></p>
          <p class="profile-role">Administrator</p>
        </div>
      </div>
      <a href="/admin/logout" class="logout-btn">ğŸšª Logout</a>
    </div>
  </aside>

  <main class="admin-main">
    <div class="page-header">
      <div class="header-top">
        <h1 class="page-title">Dashboard</h1>
        <p class="page-subtitle">Welcome back! Manage all platform users</p>
      </div>
    </div>

    <section class="stats-section">
      <div class="stat-card stat-total">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-content">
          <h3 class="stat-label">Total Users</h3>
          <p class="stat-value"><%= totalUsers %></p>
          <span class="stat-trend">+12% from last month</span>
        </div>
      </div>

      <div class="stat-card stat-active">
        <div class="stat-icon">âœ…</div>
        <div class="stat-content">
          <h3 class="stat-label">Active Users</h3>
          <p class="stat-value"><%= activeUsers %></p>
          <span class="stat-trend">Online and engaged</span>
        </div>
      </div>

      <div class="stat-card stat-blocked">
        <div class="stat-icon">ğŸš«</div>
        <div class="stat-content">
          <h3 class="stat-label">Blocked Users</h3>
          <p class="stat-value"><%= blockedUsers %></p>
          <span class="stat-trend">Suspended accounts</span>
        </div>
      </div>
    </section>

    <section class="table-section">
      <div class="section-header">
        <h2 class="section-title">User Management</h2>
        <div class="header-controls">
          <input type="text" class="search-box" id="searchInput" placeholder="ğŸ” Search users...">
        </div>
      </div>

      <% if (users && users.length > 0) { %>
        <div class="table-wrapper">
          <table class="users-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>

            <tbody>
              <% users.forEach(user => { %>
              <tr class="table-row">
                <td class="cell-name">
                  <span class="user-avatar">ğŸ‘¤</span>
                  <span><%= user.name %></span>
                </td>
                <td class="cell-email"><%= user.email %></td>

                <td class="cell-status">
                  <% if (user.isBlocked) { %>
                    <span class="status-badge status-blocked">ğŸš« Blocked</span>
                  <% } else { %>
                    <span class="status-badge status-active">âœ… Active</span>
                  <% } %>
                </td>

                <td class="cell-actions">
                  <% if (user.isBlocked) { %>
                    <a href="/admin/unblock/<%= user._id %>" class="action-btn btn-unblock" title="Unblock user">
                      Unblock
                    </a>
                  <% } else { %>
                    <a href="/admin/block/<%= user._id %>" class="action-btn btn-block" title="Block user">
                      Block
                    </a>
                  <% } %>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>

        <div class="pagination-section">
          <div class="pagination">
            <% if (page > 1) { %>
              <a href="?page=1" class="page-btn">First</a>
              <a href="?page=<%= page - 1 %>" class="page-btn">â† Prev</a>
            <% } %>

            <% for (let i = Math.max(1, page - 2); i <= Math.min(totalPages, page + 2); i++) { %>
              <a href="?page=<%= i %>"
                 class="page-btn <%= i === page ? 'page-active' : '' %>">
                <%= i %>
              </a>
            <% } %>

            <% if (page < totalPages) { %>
              <a href="?page=<%= page + 1 %>" class="page-btn">Next â†’</a>
              <a href="?page=<%= totalPages %>" class="page-btn">Last</a>
            <% } %>
          </div>

          <div class="pagination-info">
            Page <strong><%= page %></strong> of <strong><%= totalPages %></strong>
          </div>
        </div>
      <% } else { %>
        <div class="empty-state">
          <p class="empty-icon">ğŸ“­</p>
          <h3>No Users Found</h3>
          <p>There are currently no users to display.</p>
        </div>
      <% } %>
    </section>
  </main>
</div>

</body>

<script>

const searchInput = document.getElementById('searchInput');
const tableRows = document.querySelectorAll('.table-row');

if (searchInput) {
  searchInput.addEventListener('keyup', function(e) {
    const searchTerm = e.target.value.toLowerCase();

    tableRows.forEach(row => {
      const name = row.querySelector('.cell-name')?.textContent.toLowerCase() || '';
      const email = row.querySelector('.cell-email')?.textContent.toLowerCase() || '';

      if (name.includes(searchTerm) || email.includes(searchTerm)) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });

    const visibleRows = Array.from(tableRows).filter(row => row.style.display !== 'none');
    const emptyState = document.querySelector('.empty-state');
    
    if (visibleRows.length === 0 && tableRows.length > 0) {
      const table = document.querySelector('.table-wrapper');
      if (table) {
        table.style.display = 'none';
      }
      if (emptyState) {
        emptyState.style.display = 'block';
      }
    } else {
      const table = document.querySelector('.table-wrapper');
      if (table) {
        table.style.display = '';
      }
      if (emptyState) {
        emptyState.style.display = 'none';
      }
    }
  });
}
</script>

</body>
